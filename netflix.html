<script>
    async function login() {
        const user = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value.trim();

        const response = await fetch("https://netflix-api.vercel.app/api/get-account", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: user, password: pass })
        });

        if (response.ok) {
            const data = await response.json();
            localStorage.setItem('loggedIn', 'true');
            localStorage.setItem('accountData', JSON.stringify(data));
            showContent(data);
        } else {
            document.getElementById('error').style.display = 'block';
        }
    }

    function showContent(data) {
        document.getElementById('login-box').classList.add('hidden');
        document.getElementById('content-box').classList.remove('hidden');
        document.body.style.background = 'url("https://i.imgur.com/bhiplWD.jpeg") no-repeat center center fixed';
        document.body.style.backgroundSize = 'cover';

        const contentBox = document.getElementById('content-box');
        contentBox.innerHTML = `
            <h2>Netflix Account Share</h2>
            <table>
                <tr><th>Account</th><th>Password</th></tr>
                <tr>
                    <td>${data.account} <button onclick="copyText('${data.account}')">ðŸ“‹</button></td>
                    <td>${data.pass} <button onclick="copyText('${data.pass}')">ðŸ“‹</button></td>
                </tr>
                <tr><th>Profile</th><th>PIN</th></tr>
                ${data.profiles.map(p => `
                    <tr>
                        <td>${p.name}</td>
                        <td>${p.pin} <button onclick="copyText('${p.pin}')">ðŸ“‹</button></td>
                    </tr>`).join('')}
            </table>
            <button class="logout-button" onclick="logout()">Logout</button>
        `;
    }

    function logout() {
        localStorage.removeItem('loggedIn');
        localStorage.removeItem('accountData');
        document.getElementById('content-box').classList.add('hidden');
        document.getElementById('login-box').classList.remove('hidden');
        document.body.style.background = 'url("https://i.imgur.com/7syXYAp.jpeg") no-repeat center center fixed';
        document.body.style.backgroundSize = 'cover';
    }

    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast(`Copied: ${text}`);
        });
    }

    function showToast(message) {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast show';
        toast.textContent = message;
        toastContainer.prepend(toast);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 500);
        }, 5000);
    }

    document.addEventListener("DOMContentLoaded", function() {
        if (localStorage.getItem('loggedIn') === 'true') {
            const data = JSON.parse(localStorage.getItem('accountData'));
            showContent(data);
        }
    });

    function togglePasswordVisibility() {
        const passwordField = document.getElementById('password');
        const passwordFieldType = passwordField.type;
        passwordField.type = passwordFieldType === 'password' ? 'text' : 'password';
    }
</script>
